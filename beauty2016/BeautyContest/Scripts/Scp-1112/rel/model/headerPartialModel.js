var HeaderPartialModel={createActivityShare:function(sharePlatform){if(CHECKLOGIN_CONST=="TRUE"){if(checkWeiXinLogin()){if(sharePlatform!=''&&sharePlatform.length>0){var params={SharePlatform:sharePlatform};common.createActivityShare(params,function(result){var host=window.location.href;if(!host.indexOf('userbind')>0){messageBoxView.ready();}
if(result!=null&&result.ShareKey!=''){if(sharePlatform!="Wechat"){shareModel.shareActivity("header","","",sharePlatform)}else if(sharePlatform=="Wechat"){var href=common.getHostDomain();$("#PieceShareImgs").addClass("hide");$("#ActivityShareImg").removeClass("hide");HeaderPartialModel.drawQRCode(href);}}});}}}else{if(sharePlatform!=''&&sharePlatform.length>0){var params={SharePlatform:sharePlatform};common.createActivityShare(params,function(result){messageBoxView.ready();if(result!=null&&result.ShareKey!=''){if(sharePlatform!="Wechat"){shareModel.shareActivity("header","","",sharePlatform)}else if(sharePlatform=="Wechat"){var href=common.getHostDomain();$("#PieceShareImgs").addClass("hide");$("#ActivityShareImg").removeClass("hide");HeaderPartialModel.drawQRCode(href);}}});}}},drawQRCode:function(url){if(common.isWeiXin()){$("#wxshtipModal").modal("show");}else{$("#mlk-shareImages-qr").empty();if(url.indexOf('?')>-1){url=url+"&source=WechatQR";}else{url=url+"?source=WechatQR";}
var qrcode=new QRCode("mlk-shareImages-qr",{text:url,width:150,height:150,correctLevel:QRCode.CorrectLevel.L});$("#wxshModal").modal("show");}}};function getAppointment(callback){common.getAppointment(function(re){callback(re);},function(re){});}
var callindex=0;function enrcheckAppointment(number){callindex=number;if(callindex>=3){$("#enrollloading").modal("hide");$("#enroll_wait").modal("show");return;}
getAppointment(function(re){if(re.IsCompleted){window.location=DomainPreUrl+"Appointment/Success";}else{setTimeout(function(){enrcheckAppointment(callindex+1);},5000);}});}
var subindex=0;function subcheckAppointment(number){console.log(subindex);subindex=number;if(subindex>=3){$("#subscribeloading").modal("hide");$('#subscribe_wait').modal("show");return;}
getAppointment(function(re){if(re.IsCompleted){window.location=DomainPreUrl+"Appointment/SubSuccess";}else{setTimeout(function(){subcheckAppointment(subindex+1);},5000);}});}
$(function(){$('.head-enrollbtn,.menu-enrollbtn').on('click',function(){if(layoutViewModel.enableApply()){if(checkWeiXinLogin()){if(userRole=="BeautyConsultant"){$('#sorry').modal("show");return;}else{getAppointment(function(re){if(re.IsSubscribe){if(re.IsCompleted){window.location=DomainPreUrl+"Appointment/Success";}else{if(re.IsFailure){window.location=DomainPreUrl+"Appointment/Faile";}else{$("#enrollloading").modal("show");enrcheckAppointment(0);}}}else{$('#enrollstep0').modal("show");}});}}}});})
