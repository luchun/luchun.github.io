var WXShare={appid:"",jsapi_ticket:"",timestamp:"",nonceStr:"",signature:"",defaultTitle:"玫琳凯--百变美人季",title:"",img:"",url:"",desc:"",pieceKey:"",shareType:"",get_WXSDK:function(){var url=document.location.href.split('#')[0];common.get_WXSDK(url,function(jr){WXShare.appid=jr.appid;WXShare.timestamp=jr.timestamp;WXShare.nonceStr=jr.noncestr;WXShare.signature=jr.sha1;if(jr.result){setWXConfig(jr.appid,jr.timestamp,jr.noncestr,jr.sha1);}})},bindJsApi:function(){wx.onMenuShareAppMessage({title:WXShare.title,desc:WXShare.desc,link:WXShare.url,imgUrl:WXShare.img,trigger:function(res){},success:function(res){if(WXShare.shareType.toLocaleLowerCase()=="piece"||WXShare.shareType=="pieceShare"){WXShare.createPieceShare(WXShare.pieceKey);}else if(WXShare.shareType=="video"){WXShare.createVideoShare(WXShare.pieceKey);}else if(WXShare.shareType=="active"){WXShare.createActiveShare();}
$("#wxshtipModal").modal("hide");alert("已分享成功！");},cancel:function(res){$("#wxshtipModal").modal("hide");alert('您已取消分享！');},fail:function(res){$("#wxshtipModal").modal("hide");alert("分享失败，请刷新后重试！");}});wx.onMenuShareTimeline({title:WXShare.title,link:WXShare.url,imgUrl:WXShare.img,trigger:function(res){},success:function(res){if(WXShare.shareType.toLocaleLowerCase()=="piece"||WXShare.shareType=="pieceShare"){WXShare.createPieceShare(WXShare.pieceKey);}else if(WXShare.shareType=="video"){WXShare.createVideoShare(WXShare.pieceKey);}else if(WXShare.shareType=="active"){WXShare.createActiveShare();}
$("#wxshtipModal").modal("hide");alert("已分享成功！");},cancel:function(res){$("#wxshtipModal").modal("hide");alert('您已取消分享！');},fail:function(res){$("#wxshtipModal").modal("hide");alert("分享失败，请刷新后重试！");}});},createPieceShare:function(pieceKey){var params={PieceKey:pieceKey,SharePlatform:"Wechat"};common.createPieceShare(params,function(result){messageBoxView.ready();});},createVideoShare:function(pieceKey){var params={VideoKey:pieceKey,SharePlatform:"Wechat"};common.createVideoShare(params,function(result){messageBoxView.ready();},null);},createActiveShare:function(){var params={SharePlatform:"Wechat"};common.createActivityShare(params,function(result){messageBoxView.ready();});},setShareDetial:function(shareType,img,pieceKey){if(event){if(event.stopPropagation){event.stopPropagation();}
else if(window.event){window.event.cancelBubble=true;}}else{console.log("1");}
if(CheckWechatLoginShare()){var source="?source=Wechat";WXShare.shareType=shareType;if(shareType.toLocaleLowerCase()=="piece"||shareType.toLocaleLowerCase()=="pieceshare"){var url=common.getHostDomain()+"/Piece/Share/"+pieceKey+source;WXShare.title=WXShare.defaultTitle;WXShare.desc=WXPieceMsg;WXShare.img=img;WXShare.url=url;WXShare.pieceKey=pieceKey;}else if(shareType=="video"){var img2=$('#'+pieceKey).parent().find('img').attr('src')
var url=window.location.origin+location.pathname+"?tab=home&Vid="+pieceKey;WXShare.title=WXShare.defaultTitle;WXShare.desc=WXPieceMsg;WXShare.img=img2;WXShare.url=url;WXShare.pieceKey=pieceKey;}else{WXShare.title=WXShare.defaultTitle;WXShare.img=common.getHostDomain()+"/content/image/banner-logo.jpg";WXShare.url=common.getHostDomain()+source;WXShare.pieceKey=pieceKey;WXShare.desc=WXActivityMsg;}
WXShare.bindJsApi();if(img!="ready"&&shareType.toLocaleLowerCase()!="pieceshare"){$("#wxshtipModal").modal("show");}}}}
wx.ready(function(){if(location.href.toLocaleLowerCase().indexOf("/piece/share/")<0){WXShare.setShareDetial("active","ready","");}else{if($(".r-photo")){WXShare.setShareDetial("pieceShare",$(".r-photo").attr("src"),$("#hidPieceKey").val());}}});
