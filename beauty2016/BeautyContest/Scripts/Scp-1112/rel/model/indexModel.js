var indexView={contentView:function(){var $this=this;$this.isCurrentSeason=ko.observable(true);$this.seasonList=ko.observableArray();$this.seasonObj=function(obj){var $seasonObj=this;$seasonObj.seasonHref=ko.observable("");$seasonObj.seasonTitle=ko.observable("");$seasonObj.SeasonName=ko.observable(obj.Name);$seasonObj.seasonClass=ko.observable("");var unixtimeNow=Math.round(new Date().getTime());if(obj.StartDateTime<unixtimeNow&&obj.EndDateTime>unixtimeNow){$seasonObj.seasonClass="active";$seasonObj.seasonHref=DomainPreUrl+"Home/Index";}else if(unixtimeNow<obj.StartDateTime){$seasonObj.seasonClass="disable";$seasonObj.seasonHref="javascript:void(0)";$seasonObj.seasonTitle="敬请期待";}else{$seasonObj.seasonClass="";if(obj.Id==common.constchar.seasonName.liangcaimengxiang){$seasonObj.seasonHref(DomainPreUrl+"History/Index");}else if(obj.Id==common.constchar.seasonName.donggantuibian){$seasonObj.seasonHref(DomainPreUrl+"History/Index2");}else if(obj.Id==common.constchar.seasonName.hualizhanfang){$seasonObj.seasonHref(DomainPreUrl+"History/Index3");}}
$seasonObj.seasonClickEvent=function(){}};},getSeason:function(){var aData={};common.copyObject(common.basePostData,aData);common.getSeason(aData,function(r){var object1={SeasonName:"往届回顾",seasonClass:"",seasonClickEvent:"",seasonTitle:"",seasonHref:DomainPreUrl+"History/review2"};ViewModel.seasonList.push(object1);for(var i=0;i<r.Seasons.length;i++){var arr=r.Seasons;arr[i].seasonHref="javascript:void(0)";var item=new ViewModel.seasonObj(arr[i]);ViewModel.seasonList.push(item);var item=r.Seasons[i];var StartDateTime=item.StartDateTime;var endDataTime=item.EndDateTime;var VoteStartDateTime=item.ExternalVotePeriodStartDateTime;var VoteEndDateTime=item.ExternalVotePeriodEndDateTime;var unixtimeNow=Math.round(new Date().getTime());var end=common.getLocalTime(item.ExternalVotePeriodEndDateTime,"min");var start=common.getLocalTime(item.ExternalVotePeriodStartDateTime,"min");if(unixtimeNow>StartDateTime&&unixtimeNow<endDataTime){if(VoteStartDateTime<unixtimeNow&&VoteEndDateTime>unixtimeNow){$('.fiery-vote').show();}else{$('.fiery-vote').hide();}}}
var sName='全国总决赛';var object2={SeasonName:sName,seasonClass:"disable",seasonClickEvent:"",seasonTitle:"敬请期待",seasonHref:"javascript:void(0);"};ViewModel.seasonList.push(object2);$(".statusline").find(".nav-pills").find("li").not(":first").not(":last").each(trimStatuslineLi);$(".statusline").find(".nav-pills").find("li").eq(-1).each(trimStatuslineLiLast);});},ready:function(){$(document).ready(function(){indexView.getSeason();if(userRole=="CommonUser"){getAppointment(function(re){if(re.IsCompleted){$("#luck_sub_btn").html("已预约");$(".subscrstatus").html("已预约");}});}
$(".subscribe-btn").on("click",function(e){e.preventDefault();if(checkWeiXinLogin()){if(userRole=="BeautyConsultant"){$('#sorry').modal("show");return;}else{getAppointment(function(re){if(re.IsSubscribe){if(re.IsCompleted){window.location=DomainPreUrl+"Appointment/SubSuccess";}else{if(re.IsFailure){window.location=DomainPreUrl+"Appointment/SubFaile";}else{$("#subscribeloading").modal("show");subcheckAppointment(0);}}}else{window.location=DomainPreUrl+"Appointment/Subscribe";}});}}});});}}
var ViewModel=new indexView.contentView();ko.applyBindings(ViewModel,document.getElementById("statuslineApply"));indexView.ViewModel=ViewModel;indexView.ready();
